<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Installation of the Icinga-Reporting with JasperServer</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.75.1">
<meta name="keywords" content="Supervision, Icinga, Nagios, Linux">
<link rel="home" href="index.html" title="Icinga Version 1.6 Documentation">
<link rel="up" href="ch09.html" title="Chapter 9. Integration With Other Software">
<link rel="prev" href="int-mklivestatus.html" title="MKLiveStatus Integration">
<link rel="next" href="ch10.html" title="Chapter 10. Additional software">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<CENTER><IMG src="../images/logofullsize.png" border="0" alt="Icinga" title="Icinga"></CENTER>
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Installation of the Icinga-Reporting with JasperServer</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="int-mklivestatus.html">Prev</a> </td>
<th width="60%" align="center">Chapter 9. Integration With Other Software</th>
<td width="20%" align="right"> <a accesskey="n" href="ch10.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="section" title="Installation of the Icinga-Reporting with JasperServer">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="reporting"></a>Installation of the Icinga-Reporting with JasperServer</h2></div></div></div>
  

  <p>The Icinga-Reporting is based on the IDOUtils backend and just like the Icinga-Core, it will support all major database
  platforms.</p>

  <p>Here we'll give you some instructions on how to install the Icinga-Reporting with JasperServer.</p>

  <p><span class="bold"><strong>Prerequisites</strong></span></p>

  <p>You need Icinga-Core and IDOUtils installed and running. Icinga-Reporting also requires a system to run the <a class="link" href="http://jasperforge.org/projects/jasperserver" target="_top">JasperServer</a> based on <a class="link" href="http://tomcat.apache.org" target="_top">Tomcat</a>.</p>

  <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
    <p>If you don't have Icinga yet please follow the instructions given in the "<a class="link" href="quickstart-idoutils.html" title="Icinga with IDOUtils Quickstart">quickstart-idoutils</a>" documentation.</p>
  </td></tr>
</table></div>

  <p><span class="bold"><strong>Install the JasperServer</strong></span></p>

  <p>You can use the JasperServer installation binary or the specific WAR-Archive to deploy the software in an existing engine.</p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>Install from binary</p>

      <p>You can use the JasperServer-ce-linux-installer provided on <a class="link" href="http://sourceforge.net/projects/jasperserver/files/" target="_top">Sourceforge</a> with MySQL database and Tomcat
      server included. Just execute the installer-binary which leads you through the install process.</p>
    </li>
<li class="listitem">
      <p>Install WAR-Archive</p>

      <p>You can deploy the JasperServer-CE WAR into an existing Tomcat6 server and use the existing Icinga database for
      the repository. Here we describe the WAR-installation into a Tomcat6 server. Also checkout the official JasperServer
      Installation Guide <a class="link" href="http://sourceforge.net/projects/jasperserver/files/" target="_top">here.</a></p>
    </li>
</ul></div>

  <p><span class="bold"><strong>Install Tomcat using your OS repositories</strong></span></p>

  <p><span class="emphasis"><em>Fedora/RHEL/CentOS/openSuSE/SLES</em></span></p>

  <pre class="programlisting"> #&gt; yum install tomcat6</pre>

  <p><span class="emphasis"><em>Debian/Ubuntu</em></span></p>

  <pre class="programlisting"> #&gt; apt-get install tomcat6</pre>

  <p><span class="bold"><strong>Install JasperServer CE into your Tomcat Server</strong></span></p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>Download jasperserver-ce-x.x.x-bin.zip from <a class="link" href="http://sourceforge.net/projects/jasperserver/files/" target="_top">Sourceforge/Jasper</a></p>
    </li>
<li class="listitem">
      <p>Follow the installation documentation published on <a class="link" href="http://sourceforge.net/projects/jasperserver/files/" target="_top">
      Sourceforge/Jasper</a> (JasperServer-CE-Install-Guide.pdf)</p>
    </li>
</ul></div>

  <p>After successful JasperServer installation the interface is reachable at http://&lt;yourhost&gt;:8080/jasperserver and you are able
  to login with jasperadmin/jasperadmin and go to the next step. Please change the default password as soon as possible.</p>

  <p>In case of any errors consult the JasperServer Troubleshooting Guide</p>

  <p><span class="bold"><strong>Download the Templates</strong></span></p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>Download the Icinga-Reporting package from <a class="link" href="http://sourceforge.net/projects/icinga/files/" target="_top">Sourceforge/Icinga</a></p>
    </li>
<li class="listitem">
      <p><span class="bold"><strong>Or</strong></span> using GIT: you can also download all templates and the current servlet implementation in our
      <a class="link" href="git://git.icinga.org/icinga-reports.git/" target="_top">:git://git.icinga.org/icinga-reports.git/</a>.</p>

      <p>Take your clone from the icinga-reports.git to get a fresh branch</p>

      <pre class="programlisting">#&gt; git clone git://git.icinga.org/icinga-reports.git</pre>
    </li>
<li class="listitem">
      <p><span class="bold"><strong>Or</strong></span> download the software using <a class="link" href="https://git.icinga.org/index?p=icinga-reports.git;a=snapshot;h=refs/heads/master;sf=tgz" target="_top">https://git.icinga.org/index?p=icinga-reports.git;a=snapshot;h=refs/heads/master;sf=tgz</a>.</p>
    </li>
</ul></div>

  <p><span class="bold"><strong>Install the Icinga-Reporting package</strong></span></p>

  <p>Unpack the downloaded file and copy it to your JasperServer directory.</p>

  <pre class="programlisting"> #&gt; tar xzvf icinga-reports-xxx.tar.gz
 #&gt; cp icinga-reports-&lt;-version&gt;/jasperreports/package/icinga-reports.zip /opt/jasperserver/scripts/
 #&gt; cd /opt/jasperserver/scripts/</pre>

  <p>Importing the whole reporting package requires just one command: </p>
<pre class="programlisting"> #&gt; ./js-import.sh --input-zip icinga-reports.zip</pre>

  <p>If you want to update an existing repository please use the following command: </p>
<pre class="programlisting"> #&gt; ./js-import.sh --input-zip icinga-reports.zip --update</pre>

  <p>You can export the whole Icinga part of the repository with the following command: </p>
<pre class="programlisting"> #&gt; ./js-export.sh --uris /Icinga --output-zip icinga-reports.zip</pre>

  <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
    <p>If the import scripts fails, please check your jasperserver.xml for the current user and password. You can change the default user
    and password in &lt;jasperserver-ce-dir&gt;/scripts/config/js.jdbc.properties</p>
  </td></tr>
</table></div>

  <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
    <p>The export-/import-process is explained in detail in chapter 5.12 of the JasperServer CE-Install-Guide</p>
  </td></tr>
</table></div>

  <p><span class="bold"><strong>Install the JAVA classes for SLA-Reports</strong></span></p>

  <p>Generating automatic reports for last week, last month or last year requires to calculate the dates automatically for the specific
  reports. To use that feature you have to install the icinga-reporting.jar archive into the Jasper lib directory. It should be in the
  WEB-INF folder of your installation. Please don't forget to restart your jasper-server after installation.</p>

  <p><span class="bold"><strong>Configure quartz the scheduler</strong></span></p>

  <p>The reporting distribution is done via quartz scheduler. To configure the sender mail and your local gateways please edit the
  following file &lt;tomcat_home&gt;/webapps/jasperserver/WEB-INF/js.quartz.properties. Please restart the tomcat server to activate the new
  settings. </p>
<pre class="programlisting">service tomcat6 restart or /etc/init.d/tomcat restart</pre>

  <p><span class="bold"><strong>Configure your database connection</strong></span></p>

  <p>Login to http://localhost:8080/jasperserver with jasperadmin/jasperadmin.</p>

  <p>After a successful package installation you will find the datasource here:</p>

  <p>/root/Icinga/datasource (be sure that <span class="bold"><strong>Refine </strong></span>contains "changed by anyone").</p>

  <p>- Edit the existing datasource and configure your values.</p>

  <p>- Test the configuration and save the connection.</p>

  <p>- All reports in our package point to this datasource and should be able to run.</p>

  <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
    <p>Remember to clear the search field and set the 4 dropdowns to the following positions to find the datasource:</p>
  </td></tr>
</table></div>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>"Changed by anyone" (already mentioned above)</p>
    </li>
<li class="listitem">
      <p>"All"</p>
    </li>
<li class="listitem">
      <p>"Any time"</p>
    </li>
<li class="listitem">
      <p>"Any schedule"</p>
    </li>
</ul></div>

  <p>After this is done, hit search to "apply" the filters. Now you should be able to see the data sources. Default for dropdown filter
  #2 is Visualization type, which hides data sources.</p>

  <p><span class="bold"><strong>Different table prefix</strong></span></p>

  <p>If you changed your table prefix during installation you can replace the existing prefixes using the following script.</p>

  <pre class="programlisting"> grep -l -r " icinga_" .  | xargs sed -i.BAK -e 's/ icinga_/ /g'
 grep -l -r "icinga_" . | xargs sed -i.BAK -e 's/^icinga_//g'
 find . -iname "*BAK" -exec rm -f {} \;</pre>

  <p><span class="bold"><strong>Known Bugs:</strong></span> If you don't see any graph labels in a PDF export please switch from OpenJDK to
  SUNJava.</p>

  <div class="informaltable">
    <table border="0">
<colgroup>
<col>
<col>
</colgroup>
<tbody><tr>
<td>
<div class="figure">
<a name="idp14114496"></a><p class="title"><b>Figure 9.1. Icinga-Reporting in Icinga-Web</b></p>
<div class="figure-contents">
              

              <div class="mediaobject"><img src="../images/rep_avail.png" alt="Icinga-Reporting in Icinga-Web"></div>
            </div>
</div>
<p><br class="figure-break"></p>
</td>
<td>
<div class="figure">
<a name="idp14117952"></a><p class="title"><b>Figure 9.2. Icinga-Reporting TOP10 in Icinga-Web</b></p>
<div class="figure-contents">
              

              <div class="mediaobject"><img src="../images/reptop10.png" alt="Icinga-Reporting TOP10 in Icinga-Web"></div>
            </div>
</div>
<p><br class="figure-break"></p>
</td>
</tr></tbody>
</table>
  </div>

  <p><span class="bold"><strong>Integration into Icinga-Web</strong></span></p>

  <p><span class="emphasis"><em>Prerequisites</em></span></p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>icinga-core</p>
    </li>
<li class="listitem">
      <p>mysql running</p>
    </li>
<li class="listitem">
      <p>ido2db module configured and writing into the database</p>
    </li>
<li class="listitem">
      <p>Icinga-Web installed</p>
    </li>
<li class="listitem">
      <p>Jasper server installed and running</p>
    </li>
<li class="listitem">
      <p>icinga-reporting package installed on Jasper server</p>
    </li>
</ul></div>

  <p><span class="emphasis"><em>Install</em></span></p>

  <p>The reporting cronk is fully integrated into Icinga-Web so you don't have to install anything additional.</p>

  <p><span class="emphasis"><em>Configuration</em></span></p>

  <p>Depending on your current environment you have to configure the cronk to set the Jasper server location and user credentials. The
  configuration is set in the reporting module</p>
<pre class="programlisting"> $ cd app/modules/Reporting/config/
 $ ls autoload.xml config_handlers.xml module.xml routing.xml
 $ vi module.xml</pre>
<pre class="programlisting"> &lt;!-- Jasper configurations --&gt;
 &lt;setting name="jasperconfig.default"&gt;
    &lt;ae:parameter name="jasper_url"&gt;http://10.121.0.95:8080/jasperserver&lt;/ae:parameter&gt;
    &lt;ae:parameter name="jasper_user"&gt;jasperadmin&lt;/ae:parameter&gt;
    &lt;ae:parameter name="jasper_pass"&gt;jasperadmin&lt;/ae:parameter&gt;
    &lt;ae:parameter name="tree_root"&gt;/Icinga/reports&lt;/ae:parameter&gt;
 &lt;/setting&gt;
 &lt;!-- Custom config if I have more that one --&gt;
 &lt;!--
 &lt;setting name="jasperconfig.custom1"&gt;
    &lt;ae:parameter name="jasper_url"&gt;http://127.0.0.175/jasperserver&lt;/ae:parameter&gt;
    &lt;ae:parameter name="jasper_user"&gt;custom_user&lt;/ae:parameter&gt;
    &lt;ae:parameter name="jasper_pass"&gt;custom_passwd&lt;/ae:parameter&gt;
 &lt;/setting&gt;
 --&gt;</pre>
<p>Please alter the jasperconfig.default to suit your environment and change jasper_url, jasper_user and
  jasper_pass.</p>

  <p>You can integrate more than one Jasper server. The configuration name will be included into the reporting cronk later. Please select
  a unique name for each configuration.</p>

  <p>The XML configuration is prefixed. The full name for 'jasperconfig.default' is modules.reporting.jasperconfig.default. The long name
  is the real config setting for using in the cronks configuration.</p>

  <p>The default <code class="filename">/Icinga/reports</code> is the path for the icinga-reporting package but you can run every report
  configured with Jasper through the cronk. If you want to use different people for different locations you have to create more cronks with
  groups_only permissions.</p>

  <p><span class="emphasis"><em>Cronk configuration</em></span></p>

  <p>The Jasper config is ready. Now you need a cronk and tell it which configuration you want to use. Go to your cronk configuration
  (<code class="filename">cronks.xml</code>) and add a new cronk like the following:</p>

  <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
    <p>Due to config changes between 1.4 and 1.5 there are several locations for the cronk settings. Please have a look in the other
    document resource where it could be</p>
  </td></tr>
</table></div>

  <pre class="programlisting"> &lt;cronk name="icingaReportingDefault"&gt;
    &lt;ae:parameter name="module"&gt;Reporting&lt;/ae:parameter&gt;
    &lt;ae:parameter name="action"&gt;Cronk.Main&lt;/ae:parameter&gt;
    &lt;ae:parameter name="hide"&gt;false&lt;/ae:parameter&gt;
    &lt;ae:parameter name="description"&gt;Seamless Jasper Integration&lt;/ae:parameter&gt;
    &lt;ae:parameter name="name"&gt;Reporting&lt;/ae:parameter&gt;
    &lt;ae:parameter name="categories"&gt;reporting&lt;/ae:parameter&gt;
    &lt;ae:parameter name="image"&gt;cronks.Weather Could Sun&lt;/ae:parameter&gt;
    &lt;ae:parameter name="ae:parameter"&gt;
       &lt;ae:parameter name="jasperconfig"&gt;modules.reporting.jasperconfig.default&lt;/ae:parameter&gt;
       &lt;ae:parameter name="enable_onthefly"&gt;1&lt;/ae:parameter&gt;
       &lt;ae:parameter name="enable_repository"&gt;1&lt;/ae:parameter&gt;
       &lt;ae:parameter name="enable_scheduling"&gt;1&lt;/ae:parameter&gt;
    &lt;/ae:parameter&gt;
 &lt;/cronk&gt;</pre>

  <p>Have you noticed the configuration string? This is the string you configured in the <code class="filename">module.xml</code> shown in the
  topic before.</p>

  <p>You can also enable some modes for this cronk:</p>

  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p><code class="code">enable_onthefly</code> The "create reports on the fly" mode. It allows you to create your reports in the icinga-web,
      taking previews and selecting your outputs etc ...</p>
    </li>
<li class="listitem">
      <p><code class="code">enable_repository</code> A repository view. If you have scheduled reports which create the output in the Jasper server
      virtual directory. You can download Jasper resources and preview content.</p>
    </li>
</ul></div>

  <p></p>

  <p>Feel free to edit our sample reports with iReport and change these to your needs :)</p>

  <p>That's all, you're done!</p>

  <a class="indexterm" name="idp14143632"></a>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="int-mklivestatus.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="ch09.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="ch10.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">MKLiveStatus Integration </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 10. Additional software</td>
</tr>
</table>
</div>
<P class="copyright">© 2009-2012 Icinga Development Team, http://www.icinga.org</P>
</body>
</html>
